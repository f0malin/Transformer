<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
 <head>
  <link rel="stylesheet" href="http://st.pimg.net/tucs/style.css" type="text/css" />
<style>
.styleswitch {
  text-align: right;
}
</style>


<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/jquery.cookie.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/sh_main.min.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/sh_perl.min.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/jquery.styleswitch.js"></script>

<link rel="stylesheet" href="http://st.pimg.net/tucs/print.css" type="text/css" media="print" />
  <link rel="alternate" type="application/rss+xml" title="RSS 1.0" href="http://search.cpan.org/uploads.rdf" />
  <link rel="search" href="http://st.pimg.net/tucs/opensearch.xml" type="application/opensearchdescription+xml" title="SearchCPAN" />
  <title>Moose::Cookbook::Basics::Recipe2 - search.cpan.org</title>
 <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3528438-1']);
    _gaq.push(["_setCustomVar",2,"Distribution","Moose",3]);
    _gaq.push(["_setCustomVar",5,"Release","Moose-2.0403",3]);
    _gaq.push(["_setCustomVar",4,"Document","Moose::Cookbook::Basics::Recipe2",3]);
    _gaq.push(["_setCustomVar",1,"Author","DOY",3]);
    _gaq.push(['_trackPageview']);
  </script>
 </head>
 <body id="cpansearch">
<center><div class="logo"><a href="/"><img src="http://st.pimg.net/tucs/img/cpan_banner.png" alt="CPAN"></a></div></center>
<div class="menubar">
 <a href="/">Home</a>
&middot; <a href="/author/">Authors</a>
&middot; <a href="/recent">Recent</a>
&middot; <a href="http://log.perl.org/cpansearch/">News</a>
&middot; <a href="/mirror">Mirrors</a>
&middot; <a href="/faq.html">FAQ</a>
&middot; <a href="/feedback">Feedback</a>
</div>
<form method="get" action="/search" name="f" class="searchbox">
<input type="text" name="query" value="" size="35">
<br>in <select name="mode">
 <option value="all">All</option>
 <option value="module" >Modules</option>
 <option value="dist" >Distributions</option>
 <option value="author" >Authors</option>
</select>&nbsp;<input type="submit" value="CPAN Search">
</form>


 <a name="_top"></a>
  <div class=path>
<div id=permalink class="noprint"><a href="/perldoc?Moose::Cookbook::Basics::Recipe2">permalink</a></div>
  <a href="/~doy/">Jesse Luehrs</a> &gt;
  <a href="/~doy/Moose-2.0403/">Moose-2.0403</a> &gt;
  Moose::Cookbook::Basics::Recipe2
 </div>

<div class="noprint" style="float:right;align:left;width:19ex">
<a href="http://hexten.net/cpan-faces/"><img src="http://www.gravatar.com/avatar/88766de7a058697d3d0335b8d384fd2a?r=g&s=80&d=http%3A%2F%2Fst.pimg.net%2Ftucs%2Fimg%2Fwho.png" width=80 height=80 
style="float:right"
/></a>
<br style="clear:both"/>
<p style="text-align:right">Download:<br/> <a href="/CPAN/authors/id/D/DO/DOY/Moose-2.0403.tar.gz">Moose-2.0403.tar.gz</a></p>
<p style="text-align:right"><a href="http://www.annocpan.org/~DOY/Moose-2.0403/lib/Moose/Cookbook/Basics/Recipe2.pod">Annotate this POD
</a></p>

<div style="float:right">
<div class=box style='width:150px'>
<h1 class=t5>CPAN RT</h1>
<div style="margin:2px">
<table style="margin-left:auto;margin-right:auto">
<tr><td>New&nbsp;</td><td style="text-align:right"> 13</td></tr>
<tr><td>Open&nbsp;</td><td style="text-align:right"> 27</td></tr>
<tr><td>Stalled&nbsp;</td><td style="text-align:right"> 4</td></tr>
</table>
<a href="http://rt.cpan.org/NoAuth/Bugs.html?Dist=Moose">View/Report Bugs</a><br/>
</div>
</div>

</div>
</div>
<span class="noprint">
  <a href="/src/DOY/Moose-2.0403/lib/Moose/Cookbook/Basics/Recipe2.pod">Source</a> &nbsp;
</span>
<a name="___top"></a>
<div class=pod>
<div class=toc>
<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CONCLUSION'>CONCLUSION</a>
  <li class='indexItem indexItem1'><a href='#FOOTNOTES'>FOOTNOTES</a>
  <li class='indexItem indexItem1'><a href='#ACKNOWLEDGMENT'>ACKNOWLEDGMENT</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>Moose::Cookbook::Basics::Recipe2 - A simple <b>BankAccount</b> example</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>version 2.0403</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<pre class="sh_perl">  package BankAccount;
  use Moose;

  has &#39;balance&#39; =&#62; ( isa =&#62; &#39;Int&#39;, is =&#62; &#39;rw&#39;, default =&#62; 0 );

  sub deposit {
      my ( $self, $amount ) = @_;
      $self-&#62;balance( $self-&#62;balance + $amount );
  }

  sub withdraw {
      my ( $self, $amount ) = @_;
      my $current_balance = $self-&#62;balance();
      ( $current_balance &#62;= $amount )
          || confess &#34;Account overdrawn&#34;;
      $self-&#62;balance( $current_balance - $amount );
  }

  package CheckingAccount;
  use Moose;

  extends &#39;BankAccount&#39;;

  has &#39;overdraft_account&#39; =&#62; ( isa =&#62; &#39;BankAccount&#39;, is =&#62; &#39;rw&#39; );

  before &#39;withdraw&#39; =&#62; sub {
      my ( $self, $amount ) = @_;
      my $overdraft_amount = $amount - $self-&#62;balance();
      if ( $self-&#62;overdraft_account &#38;&#38; $overdraft_amount &#62; 0 ) {
          $self-&#62;overdraft_account-&#62;withdraw($overdraft_amount);
          $self-&#62;deposit($overdraft_amount);
      }
  };</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>The first recipe demonstrated how to build very basic Moose classes, focusing on creating and manipulating attributes. The objects in that recipe were very data-oriented, and did not have much in the way of behavior (i.e. methods). In this recipe, we expand upon the concepts from the first recipe to include some real behavior. In particular, we show how you can use a method modifier to implement new behavior for a method.</p>

<p>The classes in the SYNOPSIS show two kinds of bank account. A simple bank account has one attribute, the balance, and two behaviors, depositing and withdrawing money.</p>

<p>We then extend the basic bank account in the CheckingAccount class. This class adds another attribute, an overdraft account. It also adds overdraft protection to the withdraw method. If you try to withdraw more than you have, the checking account attempts to reconcile the difference by withdrawing money from the overdraft account. (1)</p>

<p>The first class, <b>BankAccount</b>, introduces a new attribute feature, a default value:</p>

<pre class="sh_perl">  has &#39;balance&#39; =&#62; ( isa =&#62; &#39;Int&#39;, is =&#62; &#39;rw&#39;, default =&#62; 0 );</pre>

<p>This says that a <b>BankAccount</b> has a <code>balance</code> attribute, which has an <code>Int</code> type constraint, a read/write accessor, and a default value of <code>0</code>. This means that every instance of <b>BankAccount</b> that is created will have its <code>balance</code> slot initialized to <code>0</code>, unless some other value is provided to the constructor.</p>

<p>The <code>deposit</code> and <code>withdraw</code> methods should be fairly self-explanatory, as they are just plain old Perl 5 OO. (2)</p>

<p>As you know from the first recipe, the keyword <code>extends</code> sets a class&#39;s superclass. Here we see that <b>CheckingAccount</b> <code>extends</code> <b>BankAccount</b>. The next line introduces yet another new attribute feature, class-based type constraints:</p>

<pre class="sh_perl">  has &#39;overdraft_account&#39; =&#62; ( isa =&#62; &#39;BankAccount&#39;, is =&#62; &#39;rw&#39; );</pre>

<p>Up until now, we have only seen the <code>Int</code> type constraint, which (as we saw in the first recipe) is a builtin type constraint. The <code>BankAccount</code> type constraint is new, and was actually defined the moment we created the <b>BankAccount</b> class itself. In fact, Moose creates a corresponding type constraint for every class in your program (3).</p>

<p>This means that in the first recipe, constraints for both <code>Point</code> and <code>Point3D</code> were created. In this recipe, both <code>BankAccount</code> and <code>CheckingAccount</code> type constraints are created automatically. Moose does this as a convenience so that your classes and type constraint can be kept in sync with one another. In short, Moose makes sure that it will just DWIM (4).</p>

<p>In <b>CheckingAccount</b>, we see another method modifier, the <code>before</code> modifier.</p>

<pre class="sh_perl">  before &#39;withdraw&#39; =&#62; sub {
      my ( $self, $amount ) = @_;
      my $overdraft_amount = $amount - $self-&#62;balance();
      if ( $self-&#62;overdraft_account &#38;&#38; $overdraft_amount &#62; 0 ) {
          $self-&#62;overdraft_account-&#62;withdraw($overdraft_amount);
          $self-&#62;deposit($overdraft_amount);
      }
  };</pre>

<p>Just as with the <code>after</code> modifier from the first recipe, Moose will handle calling the superclass method (in this case <code>BankAccount-&#62;withdraw</code>).</p>

<p>The <code>before</code> modifier will (obviously) run <i>before</i> the code from the superclass is run. Here, <code>before</code> modifier implements overdraft protection by first checking if there are available funds in the checking account. If not (and if there is an overdraft account available), it transfers the amount needed into the checking account (5).</p>

<p>As with the method modifier in the first recipe, we could use <code>SUPER::</code> to get the same effect:</p>

<pre class="sh_perl">  sub withdraw {
      my ( $self, $amount ) = @_;
      my $overdraft_amount = $amount - $self-&#62;balance();
      if ( $self-&#62;overdraft_account &#38;&#38; $overdraft_amount &#62; 0 ) {
          $self-&#62;overdraft_account-&#62;withdraw($overdraft_amount);
          $self-&#62;deposit($overdraft_amount);
      }
      $self-&#62;SUPER::withdraw($amount);
  }</pre>

<p>The benefit of taking the method modifier approach is we do not need to remember to call <code>SUPER::withdraw</code> and pass it the <code>$amount</code> argument when writing <code>CheckingAccount-&#62;withdraw</code>.</p>

<p>This is actually more than just a convenience for forgetful programmers. Using method modifiers helps isolate subclasses from changes in the superclasses. For instance, if <b>BankAccount-&#62;withdraw</b> were to add an additional argument of some kind, the version of <b>CheckingAccount-&#62;withdraw</b> which uses <code>SUPER::withdraw</code> would not pass that extra argument correctly, whereas the method modifier version would automatically pass along all arguments correctly.</p>

<p>Just as with the first recipe, object instantiation uses the <code>new</code> method, which accepts named parameters.</p>

<pre class="sh_perl">  my $savings_account = BankAccount-&#62;new( balance =&#62; 250 );

  my $checking_account = CheckingAccount-&#62;new(
      balance           =&#62; 100,
      overdraft_account =&#62; $savings_account,
  );</pre>

<p>And as with the first recipe, a more in-depth example can be found in the <em>t/recipes/moose_cookbook_basics_recipe2.t</em> test file.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONCLUSION"
>CONCLUSION <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>This recipe expanded on the basic concepts from the first recipe with a more &#34;real world&#34; use case.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FOOTNOTES"
>FOOTNOTES <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<dl>
<dt><a name='1'></a><a name="(1)"
>(1)</a></dt>

<dd>
<p>If you&#39;re paying close attention, you might realize that there&#39;s a circular loop waiting to happen here. A smarter example would have to make sure that we don&#39;t accidentally create a loop between the checking account and its overdraft account.</p>

<dt><a name='2'></a><a name="(2)"
>(2)</a></dt>

<dd>
<p>Note that for simple methods like these, which just manipulate some single piece of data, it is often not necessary to write them at all. For instance, <code>deposit</code> could be implemented via the <code>inc</code> native delegation for counters - see <a href="/~doy/Moose-2.0403/lib/Moose/Meta/Attribute/Native/Trait/Counter.pm" class="podlinkpod"
>Moose::Meta::Attribute::Native::Trait::Counter</a> for more specifics, and <a href="/~doy/Moose-2.0403/lib/Moose/Meta/Attribute/Native.pm" class="podlinkpod"
>Moose::Meta::Attribute::Native</a> for a broader overview.</p>

<dt><a name='3'></a><a name="(3)"
>(3)</a></dt>

<dd>
<p>In reality, this creation is sensitive to the order in which modules are loaded. In more complicated cases, you may find that you need to explicitly declare a class type before the corresponding class is loaded.</p>

<dt><a name='4'></a><a name="(4)"
>(4)</a></dt>

<dd>
<p>Moose does not attempt to encode a class&#39;s is-a relationships within the type constraint hierarchy. Instead, Moose just considers the class type constraint to be a subtype of <code>Object</code>, and specializes the constraint check to allow for subclasses. This means that an instance of <b>CheckingAccount</b> will pass a <code>BankAccount</code> type constraint successfully. For more details, please refer to the <a href="/~doy/Moose-2.0403/lib/Moose/Util/TypeConstraints.pm" class="podlinkpod"
>Moose::Util::TypeConstraints</a> documentation.</p>

<dt><a name='5'></a><a name="(5)"
>(5)</a></dt>

<dd>
<p>If the overdraft account does not have the amount needed, it will throw an error. Of course, the overdraft account could also have overdraft protection. See note 1.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ACKNOWLEDGMENT"
>ACKNOWLEDGMENT <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>The BankAccount example in this recipe is directly taken from the examples in this chapter of &#34;Practical Common Lisp&#34;:</p>

<p><a href="http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html" class="podlinkurl"
>http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>Moose is maintained by the Moose Cabal, along with the help of many contributors. See <a href="/~doy/Moose-2.0403/lib/Moose.pm#CABAL" class="podlinkpod"
>&#34;CABAL&#34; in Moose</a> and <a href="/~doy/Moose-2.0403/lib/Moose.pm#CONTRIBUTORS" class="podlinkpod"
>&#34;CONTRIBUTORS&#34; in Moose</a> for details.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>This software is copyright (c) 2012 by Infinity Interactive, Inc..</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>

</div>
<!-- This should probably be put in the <div class="footer"></div> -->
<script type="text/javascript">
    $(document).ready(function(){
        var startingStyle = $.cookie('css') ? $.cookie('css') : 'http://st.pimg.net/tucs/css/sh_none.min.css';
        $.fn.styleSwitch(startingStyle);
        $("#styleswitch").val(startingStyle);
        sh_highlightDocument();
        $("#styleswitch").bind(($.browser.msie ? "click" : "change"), function() {
            $.fn.styleSwitch($(this).val());
        });
    });
</script>
<div class="styleswitch">
    syntax highlighting:
    <select id="styleswitch">
        <option value="http://st.pimg.net/tucs/css/sh_none.min.css">no syntax highlighting</option>
        <option value="http://st.pimg.net/tucs/css/sh_acid.min.css">acid</option>
        <option value="http://st.pimg.net/tucs/css/sh_berries-dark.min.css">berries-dark</option>
        <option value="http://st.pimg.net/tucs/css/sh_berries-light.min.css">berries-light</option>
        <option value="http://st.pimg.net/tucs/css/sh_bipolar.min.css">bipolar</option>
        <option value="http://st.pimg.net/tucs/css/sh_blacknblue.min.css">blacknblue</option>
        <option value="http://st.pimg.net/tucs/css/sh_bright.min.css">bright</option>
        <option value="http://st.pimg.net/tucs/css/sh_contrast.min.css">contrast</option>
        <option value="http://st.pimg.net/tucs/css/sh_cpan.min.css">cpan</option>
        <option value="http://st.pimg.net/tucs/css/sh_darkblue.min.css">darkblue</option>
        <option value="http://st.pimg.net/tucs/css/sh_darkness.min.css">darkness</option>
        <option value="http://st.pimg.net/tucs/css/sh_desert.min.css">desert</option>
        <option value="http://st.pimg.net/tucs/css/sh_dull.min.css">dull</option>
        <option value="http://st.pimg.net/tucs/css/sh_easter.min.css">easter</option>
        <option value="http://st.pimg.net/tucs/css/sh_emacs.min.css">emacs</option>
        <option value="http://st.pimg.net/tucs/css/sh_golden.min.css">golden</option>
        <option value="http://st.pimg.net/tucs/css/sh_greenlcd.min.css">greenlcd</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-anjuta.min.css">ide-anjuta</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-codewarrior.min.css">ide-codewarrior</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-devcpp.min.css">ide-devcpp</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-eclipse.min.css">ide-eclipse</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-kdev.min.css">ide-kdev</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-msvcpp.min.css">ide-msvcpp</option>
        <option value="http://st.pimg.net/tucs/css/sh_kwrite.min.css">kwrite</option>
        <option value="http://st.pimg.net/tucs/css/sh_matlab.min.css">matlab</option>
        <option value="http://st.pimg.net/tucs/css/sh_navy.min.css">navy</option>
        <option value="http://st.pimg.net/tucs/css/sh_nedit.min.css">nedit</option>
        <option value="http://st.pimg.net/tucs/css/sh_neon.min.css">neon</option>
        <option value="http://st.pimg.net/tucs/css/sh_night.min.css">night</option>
        <option value="http://st.pimg.net/tucs/css/sh_pablo.min.css">pablo</option>
        <option value="http://st.pimg.net/tucs/css/sh_peachpuff.min.css">peachpuff</option>
        <option value="http://st.pimg.net/tucs/css/sh_print.min.css">print</option>
        <option value="http://st.pimg.net/tucs/css/sh_rand01.min.css">rand01</option>
	<option value="http://st.pimg.net/tucs/css/sh_solarized-dark.min.css">solarized-dark</option>
	<option value="http://st.pimg.net/tucs/css/sh_solarized-light.min.css">solarized-light</option>
        <option value="http://st.pimg.net/tucs/css/sh_style.min.css">style</option>
        <option value="http://st.pimg.net/tucs/css/sh_the.min.css">the</option>
        <option value="http://st.pimg.net/tucs/css/sh_typical.min.css">typical</option>
        <option value="http://st.pimg.net/tucs/css/sh_vampire.min.css">vampire</option>
        <option value="http://st.pimg.net/tucs/css/sh_vim-dark.min.css">vim-dark</option>
        <option value="http://st.pimg.net/tucs/css/sh_vim.min.css">vim</option>
        <option value="http://st.pimg.net/tucs/css/sh_whatis.min.css">whatis</option>
        <option value="http://st.pimg.net/tucs/css/sh_whitengrey.min.css">whitengrey</option>
        <option value="http://st.pimg.net/tucs/css/sh_zellner.min.css">zellner</option>
    </select>
</div>



<div class="footer"><div class="cpanstats">78191 Uploads, 24710 Distributions
106007 Modules, 9645 Uploaders
</div>
hosted by <a href="http://www.yellowbot.com">YellowBot</a><br/>
<a href="http://www.yellowbot.com"><img alt="do. tag. write. share." src="http://st.pimg.net/tucs/img/yellowbot_logo.gif"></a>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript" src="http://ipv4.v6test.develooper.com/js/v1/v6test.js"></script>

<script type="text/javascript">
   // v6.target = '';
   if (!v6.target) { v6.only_once = true }
   v6.site = '7A0D89A6-2B82-11DF-B9DA-F61CBD13F020';
   v6.api_server = 'http://ipv4.v6test.develooper.com';
   try {
     v6.test();
   } catch(err) {}
</script>
<script type="text/javascript">
  $(document).ready(function(){
    $("a[href^=http:]").click(function(){
      var href = $(this).attr('href');
      var m = href.match('\/\/([^\/:]+)');
      _gaq.push(['_trackEvent','External',m[1],'Document']);
    });
    $("a[href^=/CPAN/]").click(function(){
      var href = $(this).attr('href');
      _gaq.push(['_trackEvent','Download',href,'Document']);
    });
  });
</script>
<!-- Wed Apr 25 12:01:55 2012 GMT (0.247473955154419) @cpansearch1 -->
 </body>
</html>
