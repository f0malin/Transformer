<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
 <head>
  <link rel="stylesheet" href="http://st.pimg.net/tucs/style.css" type="text/css" />
<style>
.styleswitch {
  text-align: right;
}
</style>


<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/jquery.cookie.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/sh_main.min.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/sh_perl.min.js"></script>
<script type="text/javascript" src="http://st.pimg.net/tucs/js/jquery.styleswitch.js"></script>

<link rel="stylesheet" href="http://st.pimg.net/tucs/print.css" type="text/css" media="print" />
  <link rel="alternate" type="application/rss+xml" title="RSS 1.0" href="http://search.cpan.org/uploads.rdf" />
  <link rel="search" href="http://st.pimg.net/tucs/opensearch.xml" type="application/opensearchdescription+xml" title="SearchCPAN" />
  <title>IMAP::Client - search.cpan.org</title>
 <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3528438-1']);
    _gaq.push(["_setCustomVar",2,"Distribution","IMAP-Client",3]);
    _gaq.push(["_setCustomVar",5,"Release","IMAP-Client-0.13",3]);
    _gaq.push(["_setCustomVar",3,"Module","IMAP::Client",3]);
    _gaq.push(["_setCustomVar",1,"Author","CONTEB",3]);
    _gaq.push(['_trackPageview']);
  </script>
 </head>
 <body id="cpansearch">
<center><div class="logo"><a href="/"><img src="http://st.pimg.net/tucs/img/cpan_banner.png" alt="CPAN"></a></div></center>
<div class="menubar">
 <a href="/">Home</a>
&middot; <a href="/author/">Authors</a>
&middot; <a href="/recent">Recent</a>
&middot; <a href="http://log.perl.org/cpansearch/">News</a>
&middot; <a href="/mirror">Mirrors</a>
&middot; <a href="/faq.html">FAQ</a>
&middot; <a href="/feedback">Feedback</a>
</div>
<form method="get" action="/search" name="f" class="searchbox">
<input type="text" name="query" value="" size="35">
<br>in <select name="mode">
 <option value="all">All</option>
 <option value="module" >Modules</option>
 <option value="dist" >Distributions</option>
 <option value="author" >Authors</option>
</select>&nbsp;<input type="submit" value="CPAN Search">
</form>


 <a name="_top"></a>
  <div class=path>
<div id=permalink class="noprint"><a href="/perldoc?IMAP::Client">permalink</a></div>
  <a href="/~conteb/">Brenden Conte</a> &gt;
  <a href="/~conteb/IMAP-Client-0.13/">IMAP-Client-0.13</a> &gt;
  IMAP::Client
 </div>

<div class="noprint" style="float:right;align:left;width:19ex">
<a href="http://hexten.net/cpan-faces/"><img src="http://www.gravatar.com/avatar/0fa46bf468cf57ecadf4437e1ef38da2?r=g&s=80&d=http%3A%2F%2Fst.pimg.net%2Ftucs%2Fimg%2Fwho.png" width=80 height=80 
style="float:right"
/></a>
<br style="clear:both"/>
<p style="text-align:right">Download:<br/> <a href="/CPAN/authors/id/C/CO/CONTEB/IMAP-Client-0.13.tar.gz">IMAP-Client-0.13.tar.gz</a></p>
<p style="text-align:right"><a href="http://deps.cpantesters.org/?module=IMAP%3A%3AClient;perl=latest">Dependencies</a></p>
<p style="text-align:right"><a href="http://www.annocpan.org/~CONTEB/IMAP-Client-0.13/lib/IMAP/Client.pm">Annotate this POD
</a></p>
<div class=box style='width:150px; float: right'>
<h1 class=t5>Related Modules</h1>
<div style="margin:2px">
<a href="/perldoc?Mail%3A%3AIMAPClient">Mail::IMAPClient</a><br>
<a href="/perldoc?Mail%3A%3APOP3Client">Mail::POP3Client</a><br>
<a href="/perldoc?MIME%3A%3AParser">MIME::Parser</a><br>
<a href="/perldoc?Net%3A%3AIMAP">Net::IMAP</a><br>
<a href="/perldoc?Mail%3A%3AHeader">Mail::Header</a><br>
<a href="/perldoc?MIME%3A%3AHead">MIME::Head</a><br>
<a href="/perldoc?IMAP%3A%3AAdmin">IMAP::Admin</a><br>
<a href="/perldoc?IO%3A%3AFile">IO::File</a><br>
<a href="/perldoc?Data%3A%3ADumper">Data::Dumper</a><br>
<a href="/perldoc?Mail%3A%3ABox">Mail::Box</a><br>
<small>
<a href="http://perlmonks.org/?node=cpan+module+search&pivot=1&module=IMAP%3A%3AClient">more...</a><br>
By <a href="http://perlmonks.org/">perlmonks.org</a></small>
</div>
</div>

<div style="float:right">
<div class=box style='width:150px'>
<h1 class=t5>CPAN RT</h1>
<div style="margin:2px">
<table style="margin-left:auto;margin-right:auto">
<tr><td>New&nbsp;</td><td style="text-align:right"> 11</td></tr>
<tr><td>Open&nbsp;</td><td style="text-align:right"> 2</td></tr>
</table>
<a href="https://rt.cpan.org/Public/Dist/Display.html?Name=IMAP-Client">View/Report Bugs</a><br/>
</div>
</div>

</div>
</div>
  Module Version:  0.13 &nbsp;
<span class="noprint">
  <a href="/src/CONTEB/IMAP-Client-0.13/lib/IMAP/Client.pm">Source</a> &nbsp;
</span>
<a name="___top"></a>
<div class=pod>
<div class=toc>
<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#IMPORTANT!_READ_THIS_FIRST_IF_YOU_ARE_UPGRADING_FROM_PRE-0.10_TO_0.10_OR_ABOVE!'>IMPORTANT! READ THIS FIRST IF YOU ARE UPGRADING FROM PRE-0.10 TO 0.10 OR ABOVE!</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#DEFINITIONS'>DEFINITIONS</a>
  <li class='indexItem indexItem1'><a href='#METHODS_-_SUBINTERFACE'>METHODS - SUBINTERFACE</a>
  <li class='indexItem indexItem1'><a href='#METHODS_-_INTERFACE'>METHODS - INTERFACE</a>
  <li class='indexItem indexItem1'><a href='#METHODS_-_COMMANDS'>METHODS - COMMANDS</a>
  <li class='indexItem indexItem1'><a href='#METHODS_-_SUPPORT'>METHODS - SUPPORT</a>
  <li class='indexItem indexItem1'><a href='#SEARCH_KEYS'>SEARCH KEYS</a>
  <li class='indexItem indexItem1'><a href='#FETCH_RESPONSE_TUTORIAL'>FETCH RESPONSE TUTORIAL</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR/COPYRIGHT'>AUTHOR/COPYRIGHT</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<pre class="sh_perl">    IMAP::Client - Advanced manipulation of IMAP services w/ referral support</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<pre class="sh_perl">    use IMAP::Client
    
    my $imap = new IMAP::Client($server);
    unless (ref $imap) {
        die &#34;Failed to create object: $imap\n&#34;;
    }
(or)
    my $imap = new IMAP::Client();
    $imap-&#62;connect(PeerAddr =&#62; $server,
                  ConnectMethod =&#62; &#39;SSL STARTTLS PLAIN&#39;,
                  )
    or die &#34;Unable to connect to [$server]: &#34;.$imap-&#62;error();

    $imap-&#62;onfail(&#39;ERROR&#39;);
    $imap-&#62;errorstyle(&#39;STACK&#39;);
    $imap-&#62;debuglevel(1);
    $imap-&#62;capability_checking(1);
    
        sub showstats ($) {
        my $resp = shift;
            foreach my $attr (keys %{$resp}) {
                        print &#34;$attr: $resp-&#62;{$attr}\n&#34;;
            }
        }
        $imap-&#62;register_mailbox_update(\&#38;showstats);

    $imap-&#62;authenticate($user,$pass)
        or die &#34;Unable to authenticate as $user &#34;.$imap-&#62;error().&#34;\n&#34;;
(or)
    $imap-&#62;authenticate($user,$pass,$authas_user)
        or die &#34;Unable to authenticate as $user on behalf of $authas_user: &#34;.$imap-&#62;error().&#34;\n&#34;;

    $imap-&#62;id() or die $imap-&#62;error();
    $imap-&#62;capability() or die $imap-&#62;error();
    $imap-&#62;noop() or die $imap-&#62;error();

 FIXME: more examples here</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="IMPORTANT!_READ_THIS_FIRST_IF_YOU_ARE_UPGRADING_FROM_PRE-0.10_TO_0.10_OR_ABOVE!"
>IMPORTANT! READ THIS FIRST IF YOU ARE UPGRADING FROM PRE-0.10 TO 0.10 OR ABOVE! <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>As of IMAP::Client 0.10, the &#34;_active_server&#34; mechanism has been removed, replaced instead by a class-wide monitoring of objects. This means that if you have any code that utilizes the active_server functionality (using more than one connection in an instance of IMAP::Client), you will need to change your code to create seperate instances for each connection.</p>

<p>Unfortunately, backward compatibility could not be maintained with this change. However since tracking is now behind-the-scenes, this style should be the final one.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>This module was created as a low-level inteface to any IMAP server. It was built to be a &#39;clear box&#39; solution to working with an IMAP environment. The idea is that anything an IMAP client should be able to do, and any information available via the IMAP specs, should be available to a client interface and user. This way, the full strength of the IMAP protocol and data can be utilized, ideally in the most network-efficient mannger possible, rather than being contrained only to a subset of commands or data-limited responses. If the server says it, the client should be able to see it.</p>

<p>This module also takes steps to be able to handle anticipated situations for the user rather than forcing a per-implementation behavior for such expected events, such as referrals. IMAP::Client will fully support referrals, and will transparently handle them for whatever command is issued to them (so long as the referral s for anonymous or the same user with the same password - a new user or different password would require a new username/password to be obtained. As of 0.01, this is not supported, however the framework is down.</p>

<p>This module also tries to follow the various RFCs for IMAPrev1 communications very closely, enforcing client-side responsabilities where appropriate. The complete lists of RFCs referenced for this module include:</p>

<ul>
<li>RFC 3501 - INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1 (partial)</li>

<li>RFC 2086 - IMAP4 ACL extension (0.01)</li>

<li>RFC 2087 - IMAP4 QUOTA extension (0.01)</li>

<li>RFC 2088 - IMAP4 non-synchronizing literals (0.01)</li>

<li>RFC 2177 - IMAP4 IDLE command (Not supported yet)</li>

<li>RFC 2192 - IMAP4 URL Scheme (0.01)</li>

<li>RFC 2193 - IMAP4 Mailbox Referrals (0.01 [Partial])</li>

<li>RFC 2342 - IMAP4 Namespace (Not directly supported yet)</li>

<li>RFC 2359 - IMAP4 UIDPLUS extension (Partial in 0.01 - UID EXPUNGE check ok, need COPYUID and APPENDUID support)</li>

<li>RFC 2971 - IMAP4 ID extension (0.01)</li>

<li>RFC 3348 - IMAP4 Child Mailbox Extention (Not directly supported yet)</li>

<li>RFC 3502 - IMAP MULTIAPPEND extention (Not directly supported yet)</li>

<li>RFC 3516 - Binary Content Extention (Not directly supported yet)</li>

<li>RFC 3691 - Internet Message Access Protocol (IMAP) UNSELECT command (Not directly supported yet)</li>
</ul>

<p>In addition, the following drafts functionalities are also included. While functionality is included for these drafts (because a server is using them), drafts expire after 6 months, and thus functionality from the server side may be spotty at best.</p>

<ul>
<li>draft-ietf-imapext-annotate-15 - IMAP ANNOTATE Extension (Not directly supported yet)</li>

<li>draft-daboo-imap-annotatemore-08 - IMAP ANNOTATEMORE Extension (Partial in 0.12 - GETANNOTATION works)</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DEFINITIONS"
>DEFINITIONS <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<ul>
<li>sequence set - A comma-seperated list of numbers and number ranges. A number range is in the format number:number, such as &#34;2:4&#34;, meaning messages 2 through 4.</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS_-_SUBINTERFACE"
>METHODS - SUBINTERFACE <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>These are the lowest-level functions for use by the program. These offer the most raw access for interacting with an IMAP service, short of doing it manually.</p>

<dl>
<dt><a name='imap_send'></a><a name="imap_send($string)"
><b>imap_send($string)</b></a></dt>

<dd>
<p>Sends the string argument provided to the server. A tag is automatically prepended to the command.</p>

<dt><a name='imap_send_tagless'></a><a name="imap_send_tagless($string)"
><b>imap_send_tagless($string)</b></a></dt>

<dd>
<p>Send the string argument provided to the server <b>without a tag</b>. This is needed for some operations.</p>

<dt><a name='imap_receive'></a><a name="imap_receive()"
><b>imap_receive()</b></a></dt>

<dd>
<p>Accept responses from the server until the previous tag is encountered, at which point return the entire response. CAUTION: can cause your program to hang if a tagged response isn&#39;t given. For example, if the command expects more input and issues a &#39;+&#39; response, and waits for input, this function will never return.</p>

<dt><a name='imap_receive_tagless'></a><a name="imap_receive_tagless()"
><b>imap_receive_tagless()</b></a></dt>

<dd>
<p>Accept a line of response, regardless if a tag is provided. Misuse of this function can cause the module to be confused, especially if it received a tagged response and imap_receive() is subsequently used before another imap_send(). Applicable use of this function would be to read an (expected) untagged &#39;+ go ahead&#39; response. If a tagged response is (unexpectedly) received, such as in a NO or BAD response, an imap_send() must be used before the next imap_receive(). You have been warned.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS_-_INTERFACE"
>METHODS - INTERFACE <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>These are the methods for manipulating the object or retrieving information from the object.</p>

<blockquote>
<p><b>new()</b></p>

<p><b>new($server)</b></p>

<p>Creates a new IMAP object. You can optionally specify the server to connect to, using default parameters (see connect() for details). On success, an IMAP object reference is returned - on failure, a string is returned detailing the error.</p>

<p><b>debuglevel($level)</b></p>

<p>Set the debug level. Debug levels are set on a bitmask, and all debug output is to STDERR. Valid bits are as follows:</p>

<dl>
<dt><a name='0x01'></a><a name="0x01_-_Communications_dump"
><b>0x01 - Communications dump</b></a></dt>

<dd>
<blockquote>
<p>This will output all IMAP communications, with &#62;&#62; showing the sent data, and &#60;&#60; showing the received data.</p>
</blockquote>

<dt><a name='0x02'></a><a name="0x02_-_Fetch-parsing_dump"
><b>0x02 - Fetch-parsing dump</b></a></dt>

<dd>
<blockquote>
<p>This dumps a *lot* of data about the parsing of a fetch statement.</p>
</blockquote>

<p>= item <b>0x04 - Annotations dump</b></p>

<blockquote>
<p>This will print debugging information about processing getannotations and setannotations\n&#34;;</p>
</blockquote>
</dd>
</dl>

<p><b>onfail($action)</b></p>

<p>Tell the object what to do when a command fails, either in the object, or if a !OK response is received (i.e. NO or BAD). Valid values are &#39;ERROR&#39; (return undef, set error()) or &#39;ABORT&#39; (abort, printing error to stderr). Default is ERROR. Values are case insensitive.</p>

<p><b>errorstyle($action)</b></p>

<p>Controls how errors are handled when onfail is &#39;ERROR&#39;. Valid values are &#39;LAST&#39;, for only storing the last error, or &#39;STACK&#39;, where all errors are saved until the next call to error(). STACK is most useful for those programs that tend to call nested functions, and finding where a program is truly failed (so the last error doesn&#39;t erase the original error that caused the problem). Default is &#39;STACK&#39;</p>

<p><b>error()</b></p>

<p>Prints the last error encountered by the imap object. If you executed a command and received an undef in response, this is where the error description can be found.</p>

<p><b>capability_checking()</b></p>

<p>Enable or disable capability checking for those commands that support it. If enabled, a supported command will first check to see that the appropriate atom, as specified in the command&#39;s respective RFC, appears in the capability string. If it does not, the command will not be sent to the server, but immediately fail. If disabled, all commands will assume any required atom exists, and the command will be sent to the server.</p>

<p>Any valid &#39;true&#39; value will enable the checking, while any &#39;false&#39; value will disable it.</p>

<p><b>_imap_command($command, $arguments, &#60;$continuation</b>, ...)&#62;</p>

<p>Execute an IMAP command, wait for and return the response. The function accepts the command as the first argument, arguments to that command as the second argument, followed by continuation responses for if/when the server issues a &#39;+&#39; response, such as &#39;+ go ahead&#39;. If there are less continuations specified than the server requests, the command will fail in the normal manner. If there are more continuations specified than the server requests, a warning is printed, however the response is parsed as usual - if it was OK then the command will be considered successful.</p>

<p>The function returns the server response on success, and undef on failure, setting error().</p>

<p><b>connect(%args)</b></p>

<p>Connect to the supplied IMAP server. Inerits all the options of IO::Socket::SSL (and thusly, IO::Socket::INET), and adds the following custom options:</p>

<dl>
<dt><a name="ConnectMethod"
>ConnectMethod</a></dt>

<dd>
<blockquote>
<p>Sets the priority of the login methods via a space seperated priority-ordered list. Valid methods are &#39;SSL&#39;, &#39;STARTTLS&#39;, and &#39;PLAIN&#39;. The default is to try loggin in via SSL, then connecting to the standard IMAP port and negotiating STARTTLS. &#39;PLAIN&#39; is entirly unencrypted, and is not a default option - it must be specified if desired.</p>

<p>The &#39;STARTTLS&#39; method uses the starttls() command to negotiate the insecure connection to a secure status - it is functionally equivlant to using the &#39;PLAIN&#39; method and subsequently calling starttls() within the program.</p>
</blockquote>

<dt><a name="IMAPSPort"
>IMAPSPort</a></dt>

<dd>
<blockquote>
<p>Set the IMAPS port to use when connecting via the SSL method (default 993).</p>
</blockquote>

<dt><a name="IMAPPort"
>IMAPPort</a></dt>

<dd>
<blockquote>
<p>Set the IMAP port to use when connecting via the STARTTLS or PLAIN methods (default 143).</p>
</blockquote>
</dd>
</dl>

<p>The error logs are cleared during a connection attempt, since (re)connecting essentially is a new session, and any previous errors cannot have any relation the current operation. Also, the act of finding the proper method of connecting can generate internal errors that are of no concern (as long as it ultimately connects). Should the connection fail, the error() log will contain the appropriate errors generated while attempting to connect. Should the connection succeed, the error log will be clear.</p>

<p>Returns 1 on success, and undef on failure, setting error().</p>

<p><b>disconnect()</b></p>

<p>Disconnect from the server. This command can safely be used on an already-disconnected server.</p>

<p><b>register_mailbox_update(&#38;subfunction)</b></p>

<p>This function sets up a callback function for when the IMAP server sends back a Server Response in accordance with RFC3501 Section 7.3, which stiuplates that while select()ed or examine()ing a mailbox, updates as to the mailbox content can be sent back after any command as tagless responses.</p>

<p>The subfunction will be passed one hash argument. The hash argument will contain keys that represent the data type (EXISTS, RECENT), and their respective values will be the values returned by the server.</p>

<p>If no function is registered via this method, or this method is called with an &#39;undef&#39; argument, no special action will be taken should these server responses be encountered by the library.</p>
</blockquote>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS_-_COMMANDS"
>METHODS - COMMANDS <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>These are the standard IMAP commands from the IMAP::Client object. Methods return various structures, simple and complex, depending on the method. All methods return undef on failure, setting error(), barring an override via the onfail() function.</p>

<blockquote>
<p><b>capability()</b></p>

<p>Request a listing of capabilities that the server supports. Note that the object caches the response of the capability() command for determining support of certain features.</p>

<p><b>noop()</b></p>

<p>Issue a &#34;No Operation&#34; command - i.e. do nothing. Also used for idling and checking for state changes in the select()ed mailbox</p>

<p><b>logout()</b></p>

<p>Log the current user out and return This function will not work for multi-stage commands, such as those that issue a &#39;+ go ahead&#39; to indicate the continuation to send data.the connection to the unauthorized state.</p>

<p><b>starttls(%args)</b></p>

<p>Issue a STARTTLS negotiation to secure the data connection. This function will call capability() twice - once before issuing the starttls() command to verify that the atom STARTTLS is listed as a capability(), and once after the sucessful negotiation, per RFC 3501 6.2.1. See capability() for unique rules on how this module handles capability() requests. Upon successful completion, the connection will be secured. Note that STARTTLS is not available if the connection is already secure (preivous sucessful starttls(), or connect() via SSL, for example).</p>

<p>STARTTLS is checked in capability() regardless of the value of capability_checking().</p>

<p>Any call arguments in %args are passed onto the underlying IO::Socket::SSL-&#62;start_SSL() function.</p>

<p>This function returns 1 on success, since there is no output to return on success. Failures are treated normally.</p>

<p><b>authenticate($login, $password)</b></p>

<p><b>authenticate($login, $password, $authorize_as)</b></p>

<p><b>authenticate2($login, $password)</b></p>

<p><b>authenticate2($login, $password, $authorize_as)</b></p>

<p>Login in using the AUTHENTICATE mechanism. This mechanism supports authorization as someone other than the logged in user, if said user has permission to do so. authenticate() uses a one-line login sequence, while authenticate2() uses a multi-line login sequence. Both are provided for compatiblity reasons.</p>

<p>OBSOLETE WARNING: In the future, this split-line behavior will be controlled by an object function, and authenticate() will be the only function.</p>

<p><b>login($username,$password)</b></p>

<p>Login using the basic LOGIN mechanism. Passwords are sent in the clear, and there is no third-party authorization support.</p>

<p><b>select($mailbox)</b></p>

<p>Open a mailbox in read-write mode so that messages in the mailbox can be accessed. This function returns a hash of the valid tagless responses. According to RFC-3501, these responses include:</p>

<ul>
<li>FLAGS (&#60;flags&#62;)</li>

<li>&#60;n&#62; EXISTS</li>

<li>&#60;n&#62; RECENT</li>

<li>OK [UNSEEN &#60;n&#62;]</li>

<li>OK [PERMANENTFLAGS &#60;flaglist&#62;]</li>

<li>OK [UIDNEXT &#60;n&#62;]</li>
</ul>

<p>If the server supports an earlier version of the protocol than IMAPv4, the only flags required are FLAGS, EXISTS, and RECENT.</p>

<p>Finally, hash responses will have an &#39;OK&#39; key that will contain the current permissional status, either &#39;READ-WRITE&#39; or &#39;READ-ONLY&#39;, if returned by the server. Returns an empty (undefined) hash on error.</p>

<p>IMPORTANT! You should always check to see if an ALERT was issued. ALERTs should be relayed to the user if they exist!</p>

<p><b>examine($mailbox)</b></p>

<p>Identical to select(), except the mailbox is opened READ-ONLY. Returns an empty (unefined) hash on error.</p>

<p><b>create($mailbox,\%properties)</b></p>

<p>Create a mailbox with the given name. Also assigns the properties given immediately upon creation. Valid properties are:</p>

<ul>
<li>quota - A hash, with the keys being the type (aka STORAGE), and the values being the actual quota for that type, with size-based quotas given in kb</li>

<li>permissions - initial permissions for the mailbox owner(s) (equivalent to setacl), for if the owner needs different permissions than the server&#39;s default</li>
</ul>

<p>For example: $imap-&#62;create(&#34;asdfasdf&#34;,{quota=&#62;{&#39;STORAGE&#39;,50000}, permissions =&#62; &#39;lrws&#39;})</p>

<p><b>delete($mailbox)</b></p>

<p>Delete an existing mailbox with the given name. <b>NOTE</b>: RFC notes that sub-mailboxes are not automatically deleted via this command.</p>

<p><b>rename($oldmailbox,$newmailbox)</b></p>

<p>Rename an existing mailbox from oldmailbox to newmailbox.</p>

<p><b>subscribe($mailbox)</b></p>

<p>Subscribe the authorized user to the given mailbox</p>

<p><b>unsubscribe($mailbox)</b></p>

<p>Unsubscribe the authorized user from the given mailbox</p>

<p><b>list($reference,$mailbox)</b></p>

<p>List all the local mailboxes the authorized user can see for the given mailbox from the given reference. Returns a listref of hashrefs, with each list entry being one result. Keys in the hashes include FLAGS, REFERENCE, and MAILBOX, and their returned values, respectivly.</p>

<p><b>lsub($reference,$mailbox)</b></p>

<p>List all the local subscriptions for the authorized user for the given mailbox from the given reference. Returns a listref of hashrefs, which each list entry being one result. Keys in the hashes include FLAGS, REFERENCE, and MAILBOX, and their returned values, respectivly.</p>

<p><b>status($mailbox,@status)</b></p>

<p>Get the provided status items on the currently select()ed or examine()d mailbox. Each argument is a different status information item to query. According to RFC, the following tags are valid for status() queries: <b>MESSAGES</b>, <b>RECENT</b>, <b>UIDNEXT</b>, <b>UIDVALIDITY</b>, <b>UNSEEN</b>. Since there may be future RFC declarations or custom tags for various servers, this module does not restrict to the above tags, but rather lets the server handle them appropriately (which may be a NO or BAD response).</p>

<p>Upon successful completion, the return value will be a hash of the queried items and their returned values.</p>

<p><b>append($mailbox, $message, $flaglist)</b></p>

<p>Append the given message to the given mailbox with the given flaglist. For information on the flaglist, see the buildflaglist() method.</p>

<p>The append() method will do some housekeeping on any message that comes in - namely, it will ensure that all lines end in &#39;CRLF&#39;. The reasoning is that the RFC strictly states that lines must end in &#39;CRLF&#39;, and most *nix files end with just &#39;LF&#39; - therefore rather than force every program to muck with message inputs to ensure compatiblity, the append() method will ensure it for them.</p>

<p>This &#39;CRLF&#39; assurance is done for all commands - however its noted here because it also does it to the message itself in this method, potentially modifying data.</p>

<p>Unless overridden, append will check for the LITERAL+ capability() atom, and use non-synchronizing literals if supported - otherwise, it will use the standard IMAP dialog.</p>

<p>Upon successful execution, the return of this function depends on the type of variable receiving the data.</p>

<p><b>check()</b></p>

<p>Request a checkpoint of the currently select()ed mailbox. The specific actions and responses by the server are on an implementation-dependant basis.</p>

<p><b>close()</b></p>

<p>Close the currently select()ed mailbox, expunge()ing any messages marked as \Deleted first. Unlike expunge(), this command does not return any untagged responses, and closes the mailbox upon completion.</p>

<p><b>expunge()</b></p>

<p>Expunge() any messages marked as \Deleted from the currently select()ed mailbox. Will return untagged responses indicating which messages have been expunge()d.</p>

<p><b>search($searchstring,&#60;$charset</b>)&#62;</p>

<p>Search for messages in the currently select()ed or examine()d mailbox matching the searchstring critera, where searchstring is a valid IMAP search query.See the end of this document for valid search terminology. The charset argument is optional - undef defaults to ASCII.</p>

<p>This function returns a listref of sequence IDs that match the query when in list context, and a space-seperated list of sequence IDs if in scalar context. The scalar context allows nested calling within functions that require sequences, such as `fetch(search(&#39;RECENT&#39;),undef,&#39;FLAGS&#39;)`</p>

<p><b>fetch($sequence, [\%body, \%body, ...], @other)</b></p>

<p>Fetch message data. The first argument is a sequence set to retrieve.</p>

<p>The second argument, the body hash ref, is designed to easily create the body section of the query, and takes the following arguments:</p>

<ul>
<li>body
<p>Specify the section of the body to fetch(). undef is allowed, meaning no arguments to the BODY option, which will request the full message (unless a header is specified - see below).</p>
</li>

<li>offset
<p>Specify where in the body to start retrieving data, in octets. Default is from the beginning (0). If the offset is beyond the end of the data, an empty string will be returned. Must be specified with the length option.</p>
</li>

<li>length
<p>Specify how much data to retrieve starting from the offset, in octets. If the acutal data is less than the length specified, the acutal data will be returned. There is no default value, and thus must be specified if offset is used.</p>
</li>

<li>header
<p>Takes either &#39;ALL&#39;, &#39;MATCH&#39;, or &#39;NOT&#39;. &#39;ALL&#39; will return all the headers, regardless of the contents of headerfields. &#39;MATCH&#39; will only return those headers that match one of the terms in headerfields, while &#39;NOT&#39; will return only those headers that *do not* match any of the terms in the headerfields.</p>
</li>

<li>headerfields
<p>Used when header is &#39;MATCH&#39; or &#39;NOT&#39;, it specifies the headers to use for comparison. This argument is a string of space-seperated terms.</p>
</li>

<li>peek
<p>When set to 1, uses the BODY.PEEK command instead of BODY, which preserves the \Seen state of the message</p>
</li>
</ul>

<p>A single hash reference may be supplied for a single body command. If multiple body commands are required, they must be passed inside an array reference (i.e. [\%hash, \%hash]).</p>

<p>If an empty hashref is supplied as a \%body argument, it is interpreted as a BODY[] request.</p>

<p>The third argument, other, is a string of space-seperated stand-alone data items. Valid items via RFC3501 include:</p>

<ul>
<li>BODY
<p>The non-extensible form of BODYSTRUCTURE (not to be confused with the first argument - this command fetches structure, not content)</p>
</li>

<li>BODYSTRUCTURE
<p>The MIME-IMB body structure of the message.</p>
</li>

<li>ENVELOPE
<p>The RFC-2822 envelope structure of the message.</p>
</li>

<li>FLAGS
<p>The flags set for the message</p>
</li>

<li>INTERNALDATE
<p>The internal date of the message</p>
</li>

<li>RFC822, RFC822.HEADER, RFC822.SIZE, RFC822.TEXT
<p>RFC822, RFC822.HEADER, and RFC822.TEXT are equivilant to the similarly-named BODY options from the first argument, except for the format they return the results in (in this case, RFC-822). Except RFC822.HEADER, which is the RFC822 equivilant of BODY.PEEK[HEADER], there is no &#39;.PEEK&#39; alternative available, so the \Seen state may be altered. SIZE returns the RFC-822 size of the message and does not change the \Seen state.</p>
</li>

<li>UID
<p>The unique identifier for the message.</p>
</li>

<li>ALL
<p>equivalent to FLAGS, INTERNALDATE, RFC822(SIZE), ENVELOPE</p>
</li>

<li>FAST
<p>equivalent to FLAGS, INTERNALDATE RFC822(SIZE)</p>
</li>

<li>FULL
<p>equivalent to FLAGS, INTERNALDATE, RFC822(SIZE), ENVELOPE, BODY()</p>
</li>
</ul>

<p>The final argument, other, provides some basic option-sanity checking and assures that the options supplied are in the proper format.</p>

<p>The return value is a hash of nested hashes. The first level of hashes represents the message id. The second and subsequent levels represents a level of multiparts, equivilant to the depth computed by the server and used for the body[] section retrievals. Particularly subject to nested hashing are the BODY and BODYSTRUCTURE commands. Commands used in the other argument typically are found on the base level of the hash: for example, UID and FLAGS would be found on the first level. Structure and BODY parts are found nested in their appropriate sections.</p>

<p>This is a complex method for a data-rich command. Here are some examples to aid in your understanding:</p>

<p>This command is equivilant to `xxx FETCH 1 (BODY[1] BODY.PEEK[HEADER.FIELDS (FROM SUBJECT TO DATE X-STATUS) RFC822.SIZE FLAGS]`: $imap-&#62;fetch(1,[{header=&#62;&#39;MATCH&#39;, headerfields=&#62;&#39;FROM SUBJECT TO DATE X-STATUS &#39;, peek=&#62;1}, {body=&#62;1, offset=&#62;1024, length=&#62;4000}], qw(RFC822.SIZE FLAGS));</p>

<p>Please see the &#34;Fetch Response Tutorial&#34; at the bottom of this document.</p>

<p><b>store($sequence, $operation, $flaglist)</b></p>

<p>Set flags on a sequence set. For information on the flaglist, see the buildflaglist() method. See DEFINITIONS above for &#34;sequence set&#34;.</p>

<p>Operation is one of the following actions to take on the flags:</p>

<ul>
<li>FLAGS - Replace the currently set flags of the message(s) with the flaglist.</li>

<li>+FLAGS - Add the flaglist flags to the currently set flags of the message(s).</li>

<li>-FLAGS - Remove the flaglist flags from the currently set flags of the message(s).</li>
</ul>

<p>Under normal circumstances, the command returns the new value of the flags as if a fetch() of those flags was done. You can append a .SILENT operation to any of the above commands to negate this behavior, and not have it return the new flag values.</p>

<ul>
<li>FLAGS.SILENT - Equivalent to FLAGS, but without returning a new value</li>

<li>+FLAGS.SILENT - Equivalent to +FLAGS, but without returning a new value</li>

<li>-FLAGS.SILENT - Equivalent to -FLAGS, but without returning a new value
<p>NOTE ON SILENT OPTION: The server SHOULD send an untagged fetch() response if a change to a message&#39;s flags from an external source is observed. The intent is that the status of the flags is determinate without a race condition. In other words, .SILENT may still return important (unexpected) flag change information!</p>
</li>
</ul>

<p><b>copy($sequence, $mailbox)</b></p>

<p>Copy a sequence set of messages to a mailbox. See DEFINITIONS above for &#34;sequence set&#34;</p>

<p><b>uidcopy($sequence,$mailbox)</b></p>

<p>Identical to the copy() command, except set is a UID set rather than a sequence set.</p>

<p><b>uidfetch($sequence,$fetchstring)</b></p>

<p>Identical to the fetch() command, except set is a UID set rather than a sequence set.</p>

<p><b>uidstore($sequence,$operation, $flaglist)</b></p>

<p>Identical to the store() command, except set is a UID set rather than a sequence set.</p>

<p><b>uidexpunge($sequence)</b></p>

<p>Identical to the expunge() command, except you can specify a set of messages to be expunged, rather than the entire mailbox, via a UID set. This function ensures the existance of the UIDPLUS atom in the capability() command.</p>

<p>Note: At this time, the function does not implement the reccomendation in RFC2359, which suggestests that clients use alternate methods in selectivly expunging messages on servers that do not support UIDPLUS.</p>

<p><b>uidsearch($searchstring)</b></p>

<p>Identical to the search() command, except the results are returned with UIDs instead of sequence IDs. See the end of this document for valid search terminology.</p>

<p><b>setacl($mailbox,$user,@permissions)</b></p>

<p>Modify the access control lists to set the provided permissions for the user on the mailbox, overwriting any previous access controls for the user. See the end of this document for a complete list of possible permissions for use in the permissions list.</p>

<p><b>deleteacl($mailbox,$user)</b></p>

<p>Remove all permissions for user on the mailbox&#39;s access control list.</p>

<p><b>getacl($mailbox)</b></p>

<p>Get the access control list for the supplied mailbox. Returns a two-level hash, with the first level consisting of userIDs, and the second level consisting of a hash of the permissions for the parent userID, in both short and long form.</p>

<p><b>grant($mailbox,$user,@permissions)</b> (not an official RFC2086 command)</p>

<p>Modify the access control lists to add the specified permissions for the user on the mailbox. See the end of this document for a complete list of possible permissions for use in the permissions list.</p>

<p><b>revoke($mailbox,$user,@permissions)</b> (not an official RFC2086 command)</p>

<p>Modify the access control lists to remove the specified permissions for the user on the mailbox. If the end result is no permissions for the user, the user will be deleted from the acl list. See the end of this document for a complete list of possible permissions for use in the permissions list.</p>

<p><b>listrights($mailbox,$user)</b></p>

<p>Get the list of access controls that may be granted to the supplied user for the supplied mailbox. Returns a hash populated with both short and long rights definitions for testing for the existance of a permision, like $hash{&#39;list&#39;}.</p>

<p><b>myrights($mailbox)</b></p>

<p>Get the access control list information for the currently authorized user&#39;s access to the supplied mailbox. Returns a hash of the permissions available, in both short and long form.</p>

<p><b>setquota($mailbox,$type,$quota)</b></p>

<p>Set the quota on the mailbox. Type is the type of quota to specify, for example STORAGE. Sized-based quota is supplied in KB.</p>

<p><b>getquota($mailbox)</b></p>

<p>Get the quota for the supplied mailbox. The provided mailbox must be a quota root, and the authorized user might need to be an administrator, otherwise a &#34;NO&#34; reponse will be returned. getquotaroot() is likely the more applicable command for finding the current quota information on a mailbox. Quota is returned in a hash of lists: The hash elements correspond to the quota type (for example, STORAGE). The list consists of all numbers that corresponded to the quote type.</p>

<p>For example, the RFC specifies that the STORAGE type returns the quota used in the first element, and the maximum quota in the second. Quota units corresponding to sizes are in KB.</p>

<p><b>getquotaroot($mailbox)</b></p>

<p>Fetch the list of quotaroots and the quota for the provided mailbox. This command is idential to the getquota() command, except the query doesn&#39;t have to be at the quota root, since this command will find the quota root for the specified mailbox, then return the results based on the results of the find. Thus, there will be an extra hash item, &#39;ROOT&#39;, that specified what was used as the quota root. Quota units corresponding to sizes are in KB.</p>

<p><b>rlist($reference,$mailbox)</b></p>

<p>List all the mailboxes the authorized user can see for the given mailbox from the given reference. This command lists both local and remote mailboxes, and can also be an indicator to the server that the client (you) supports referrals. Not reccomended if referrals are not supported by the overlying program.</p>

<p>Returns a listref of hasherefs, one per element, where each hashes keys include FLAGS, REFERENCE, and MAILBOX.</p>

<p>IMPORTANT: Referrals come in a &#34;NO&#34; response, so this command will fail even if responded to with a referral. The referral MUST be pulled out of the error(), and can then be parsed by the parse_referral() command if desired, to extract the important pieces for the clients used.</p>

<p>Unless overridden, rlist will check for the MAILBOX-REFERRALS capability() atom before executing the command. If the capability is not advertised, the function will fail without sending the request to the server.</p>

<p><b>rsub($reference,$mailbox)</b></p>

<p>List all the subscriptions for the authorized user for the given mailbox from the given reference. This command lists both local and remote subscriptions, and can also be an indicator to the server that the client (you) supports referrals. Not reccomended if referrals are not supported by the overlying program.</p>

<p>Returns a listref of hasherefs, one result per element, where each hashes keys include FLAGS, REFERENCE, and MAILBOX.</p>

<p>IMPORTANT: Referrals come in a &#34;NO&#34; response, so this command will fail even if responded to with a referral. The referral MUST be pulled out of the error(), and can then be parsed by the parse_referral() command if desired, to extract the important pieces for the clients used.</p>

<p>Unless overridden, rlsub will check for the MAILBOX-REFERRALS capability() atom before executing the command. If the capability is not advertised, the function will fail without sending the request to the server.</p>

<p><b>idle(FIXME)</b></p>

<p>Issue IDLE command, currently unimplemented.</p>

<p><b>id(%perams)</b></p>

<p>Provide identifying information to the server, and have the server do the same to you. The client can request the server&#39;s information without sharing its own by supplying an undef perams argument. The information by both parties is useful for statistical or debugging purposes, but otherwise serves no other functional purpose.</p>

<p>The perams arguemnt is a hash, since information is in a key-value format. Keys can be anything, but must be less than 30 characters in length, and values must be less than 1024 characters in length. There are a set keys defined by the RFC that are reccomended: These include:</p>

<ul>
<li>name - Name of the program</li>

<li>version - Version number of the program</li>

<li>os - Name of the operating system</li>

<li>os-version - Version of the operating system</li>

<li>vendor - Vendor of the client/server</li>

<li>support-url - URL to contact for support</li>

<li>address - Postal address of contact/vendor</li>

<li>date - Date program was released, specified as a date-time in IMAP4rev1</li>

<li>command - Command used to start the program</li>

<li>arguments - Arguments supplied on the command line, if any</li>

<li>environment - Description of environment, i.e., UNIX environment List all the subscriptions for the authorized user for the given mailbox from the given reference.variables or Windows registry settings</li>
</ul>

<p>None of the keys are required - if the client wishes not to supply information for a key, the key is simply omitted. Not all clients support this extention: Support can be identified by using the capability() command, and verifying the atom &#34;ID&#34; is included in the server-supplied list.</p>

<p><b>getannotation($mailbox, $entry_specifier, $attribute_specifier)</b></p>

<p>Retrieve annotations on a mailbox from the server. If the mailbox argument is empty, it will retrieve global server annotations instead.</p>

<p>The entry specifier indicates which type of annotation you will retrieve. the &#34;*&#34; wildcard is valid for retrieving all annotations, while the &#34;%&#34; wildcard will match all text except the hierarchy delimiter &#39;/&#39;.</p>

<p>As of draft-ietf-imapext-annotate-15, valid global entries are:</p>

<ul>
<li>/comment
<p>Defines a comment or note associated with the server</p>
</li>

<li>/motd
<p>Defines a &#34;message of the day&#34; for the server (Read-Only)</p>
</li>

<li>/admin
<p>Indicates a method for contacting the server administrator (Read-Only)</p>
</li>

<li>/vendor/&#60;vendor-token&#62;
<p>Defines the top-level of entries associated with the server as created by a particular product of some vendor. Vendor tokens are registered with IANA, using the ACAP [RFC2244] vendor subtree registry.</p>
</li>
</ul>

<p>... and the mailbox entries are ...</p>

<ul>
<li>/comment
<p>Defines a per-mailbox comment, connected with the specified mailbox</p>
</li>

<li>/sort
<p>Defines the default sort criteria [I-D.ietf-imapext-sort] to use when first displaying the mailbox contents to the user, or NIL if sorting is not required.</p>
</li>

<li>/thread
<p>Defines the default thread criteria [I-D.ietf-imapext-sort] to use when first displaying the mailbox contents to the user, or NIL if threading is not required. This takes precidence over the /sort annotation.</p>
</li>

<li>/check
<p>A true/false value that indicates whether this mailbox should be checked at regular intervals by the client.</p>
</li>

<li>/checkperiod
<p>if /check is true, this numberic value indicates a period of minutes that the client should check the mailbox.</p>
</li>

<li>/vendor/&#60;vendor-token&#62;
<p>Identical to the global version, except they apply only to the specified mailbox.</p>
</li>
</ul>

<p>The attribute specifier indicates which part of the annotation you wish to receive. As of draft-ietf-imapext-annotate-15, valid global attributes are</p>

<ul>
<li>/value
<p>String or binary data representing the value of the annotation. NIL can be stored to delete an annotation. Text value sshould use the utf-8 character set. Binary data uses the &#34;literal8&#34; syntax element [I-D.melnikov-imap-ext-abnf] to store and retreive such data.</p>
</li>

<li>/size
<p>the size, in octets, of the value. (Read-only)</p>
</li>

<li>/content-language
<p>Language used for the value. This SHOULD be set if the value stored is textual.</p>
</li>
</ul>

<p>In addition, all attributes have a &#39;.priv&#39; and a &#39;.shared&#39; suffix, meaning private and shared, respecitvly. If neither attribute suffix is specified, both will be retrieved (if allowed).</p>

<p>Returns a nested hash reference with the mailbox name as the first layer, the entry as the second layer, the attribute name in the third layer.</p>

<p>Structure example:</p>

<blockquote>
<p>$r{&#60;mailbox&#62;}-&#62;{&#60;tag&#62;}-&#62;{&#60;attribute&#62;} = value</p>
</blockquote>

<p><b>setannotation($mailbox, $mailbox, \%annoation_hash)</b></p>

<p>Set annotations on a mailbox from the server. If the mailbox argument is empty, it will attempt to set global server annotations instead.</p>

<p>For details on annotations and its arguments, see the getannotation() command.</p>

<p>The setannotation() command only accepts annotations for one mailbox at a time - as a result, the setannotation() command accepts a mailbox argument and an attribute tree, rather than the entire annotation hash that getannotation returns.</p>

<p>As a result, setannotation takes the same type of hash that getannotation returns, except starting at the mailbox level. For example, the hash must be in the form of</p>

<blockquote>
<p>$r{&#60;tag&#62;}-&#62;{&#60;attribute&#62;} = value</p>
</blockquote>

<p>The the first level is for which tags to set, and the second level is what attributes those tags will have, while the value is the actual value to assign.</p>

<p>One key difference between the getannotation() and setannotation() hashes is that the setannotation() mailbox can contain a wildcard - for example, setting &#39;INBOX.%&#39; as the mailbox will add an annotation for all mailboxes at the top-level of the INBOX hierarchy.</p>
</blockquote>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS_-_SUPPORT"
>METHODS - SUPPORT <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<pre class="sh_perl">    These are the support methods created to support the coder in creating some of the more complex and open-ended arguments for the above command methods.</pre>

<blockquote>
<p><b>buildacl(@acls)</b></p>

<p>This function is provided for the ease of creating an appropriate aclstring. The set of arguments is the set of permissions to include in the aclstring. The following are the supported rights:</p>

<ul>
<li>lookup, list, l - mailbox is visible to list()/lsub()/rlist()/rlsub() commands</li>

<li>read, r - select() the mailbox, perform check(), fetch(), PARTIAL?, search(), copy() from mailbox</li>

<li>seen, s - keep seen/unseen information across sessions (store() SEEN flag)</li>

<li>write, w - store() flags other than SEEN and DELETE</li>

<li>insert, i - perform append(), copy() into mailbox</li>

<li>post, p - send mail to submission address for mailbox</li>

<li>create, c - create() new sub-mailboxes</li>

<li>delete, d - store() DELETED flag, perform expunge()s</li>

<li>administer, admin, a - perform setacl() commands</li>

<li>all - all the above rights. Overrides all other commands</li>

<li>none - none of the above rights. This is the same as providing no arguments. Is overriden by any other supplied commands</li>

<li>0-9 - implementation or site defined rights (nonstandard)</li>
</ul>

<p><b>buildfetch([\%body,\%body,...],$other)</b></p>

<p>Builds a fetch query to get only the data you want. The first argument, the body hash ref, is designed to easily create the body section of the query, and takes the following arguments:</p>

<ul>
<li>body
<p>Specify in a section of the body to fetch(). undef is allowed, meaning no arguments to the BODY option, which will request the full message (unless a header is specified - see below).</p>
</li>

<li>offset
<p>Specify where in the body to start retrieving data, in octets. Default is from the beginning (0). If the offset is beyond the end of the data, an empty string will be returned. Must be specified with the length option.</p>
</li>

<li>length
<p>Specify how much data to retrieve starting from the offset, in octets. If the acutal data is less than the length specified, the acutal data will be returned. There is no default value, and thus must be specified if offset is used.</p>
</li>

<li>header
<p>Takes either &#39;ALL&#39;, &#39;MATCH&#39;, or &#39;NOT&#39;. &#39;ALL&#39; will return all the headers, regardless of the contents of headerfields. &#39;MATCH&#39; will only return those headers that match one of the terms in headerfields, while &#39;NOT&#39; will return only those headers that *do not* match any of the terms in the headerfields.</p>
</li>

<li>headerfields
<p>Used when header is &#39;MATCH&#39; or &#39;NOT&#39;, it specifies the headers to use for comparison. This argument is a string of space-seperated terms.</p>
</li>

<li>peek
<p>When set to 1, uses the BODY.PEEK command instead of BODY, which preserves the \Seen state of the message</p>
</li>
</ul>

<p>A single hash reference may be supplied for a single body command. If multiple body commands are required, they must be passed inside an array reference (i.e. [\%hash, \%hash]).</p>

<p>If an empty hashref is supplied as a \%body argument, it is interpreted as a BODY[] request.</p>

<p>The final argument, other, is a string of space-seperated stand-alone data items. Valid items via RFC3501 include:</p>

<ul>
<li>BODY
<p>The non-extensible form of BODYSTRUCTURE (not to be confused with the first argument - this command fetches structure, not content)</p>
</li>

<li>BODYSTRUCTURE
<p>The MIME-IMB body structure of the message.</p>
</li>

<li>ENVELOPE
<p>The RFC-2822 envelope structure of the message.</p>
</li>

<li>FLAGS
<p>The flags set for the message</p>
</li>

<li>INTERNALDATE
<p>The internal date of the message</p>
</li>

<li>RFC822, RFC822.HEADER, RFC822.SIZE, RFC822.TEXT
<p>RFC822, RFC822.HEADER, and RFC822.TEXT are equivilant to the similarly-named BODY options from the first argument, except for the format they return the results in (in this case, RFC-822). There is no &#39;.PEEK&#39; available, so the \Seen state may be altered. SIZE returns the RFC-822 size of the message and does not change the \Seen state.</p>
</li>

<li>UID
<p>The unique identifier for the message.</p>
</li>

<li>ALL
<p>equivalent to FLAGS, INTERNALDATE, RFC822.SIZE, ENVELOPE</p>
</li>

<li>FAST
<p>equivalent to FLAGS, INTERNALDATE RFC822.SIZE</p>
</li>

<li>FULL
<p>equivalent to FLAGS, INTERNALDATE, RFC822.SIZE, ENVELOPE, BODY</p>
</li>
</ul>

<p>The final argument, other, provides some basic option-sanity checking and assures that the options supplied are in the proper format. For example, if a program has a list of options to use, a simple buildfetch(undef,join(&#39; &#39;,@args)) would manipulate the terms into a format suitable for a fetch() command. It is highly recommended to pass options through this function rather than appending a pre-formatted string to the functions output to ensure proper formatting.</p>

<p><b>buildflaglist(@flags)</b></p>

<p>This function is provided for the ease of creating an appropriate status flags string. Simply provide it with a list of flags, and it will create a legal flags string for use in any append() command, store() command, or any other command that may require status flags.</p>

<p>Since the RFCs don&#39;t explicity define valid flags, implementation dependant and custom flags may exist on any given service - therefore this function will blindly interpret any status flag you give it. The server may reject the subsequent command due to an invalid flag.</p>

<p><b>check_capability($tag)</b></p>

<p>This function returns a simple true/false answer to whether the supplied tag is found in the capability() list, indicating support for a certain feature. Note: capability() results are cached by the object, however if capability() has not been executed at least once, this will cause it to do so.</p>

<p><b>parse_referral($referral_line)</b></p>

<p>Given a referral line (the pre-cursory tag and &#39;NO&#39; response are optional), this function will return a hash of the important information needed to connect to the referred server. Hash keys for connecting to a referred server include SCHEME, USER, AUTH, HOST, PORT. Other keys for use after successfull connection to the referred server include PATH, QUERY, UID, UIDVALIDITY, TYPE, SECTION. Others are possible if returned within the path as &#39;/;key=value&#39; format.</p>
</blockquote>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEARCH_KEYS"
>SEARCH KEYS <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<ul>
<li>&#60;sequence set&#62; - Messages with message sequence numbers corresponding to the specified message sequence number set.</li>

<li>ALL - All messages in the mailbox; the default initial key for ANDing.</li>

<li>ANSWERED - Messages with the \Answered flag set.</li>

<li>BCC &#60;string&#62; - Messages that contain the specified string in the envelope structure&#39;s BCC field.</li>

<li>BEFORE &#60;date&#62; - Messages whose internal date (disregarding time and timezone) is earlier than the specified date.</li>

<li>BODY &#60;string&#62; - Messages that contain the specified string in the body of the message.</li>

<li>CC &#60;string&#62; - Messages that contain the specified string in the envelope structure&#39;s CC field.</li>

<li>DELETED - Messages with the \Deleted flag set.</li>

<li>DRAFT - Messages with the \Draft flag set.</li>

<li>FLAGGED - Messages with the \Flagged flag set.</li>

<li>FROM &#60;string&#62; - Messages that contain the specified string in the envelope structure&#39;s FROM field.</li>

<li>HEADER &#60;field-name&#62; &#60;string&#62; - Messages that have a header with the specified field-name (as defined in [RFC-2822]) and that contains the specified string in the text of the header (what comes after the colon). If the string to search is zero-length, this matches all messages that have a header line with the specified field-name regardless of the contents.</li>

<li>KEYWORD &#60;flag&#62; - Messages with the specified keyword flag set.</li>

<li>LARGER &#60;n&#62; - Messages with an [RFC-2822] size larger than the specified number of octets.</li>

<li>NEW - Messages that have the \Recent flag set but not the \Seen flag. This is functionally equivalent to &#34;(RECENT UNSEEN)&#34;.</li>

<li>NOT &#60;search-key&#62; - Messages that do not match the specified search key.</li>

<li>OLD - Messages that do not have the \Recent flag set. This is functionally equivalent to &#34;NOT RECENT&#34; (as opposed to &#34;NOT NEW&#34;).</li>

<li>ON &#60;date&#62; - Messages whose internal date (disregarding time and timezone) is within the specified date.</li>

<li>OR &#60;search-key1&#62; &#60;search-key2&#62; - Messages that match either search key.</li>

<li>RECENT - Messages that have the \Recent flag set.</li>

<li>SEEN - Messages that have the \Seen flag set.</li>

<li>SENTBEFORE &#60;date&#62; - Messages whose [RFC-2822] Date: header (disregarding time and timezone) is earlier than the specified date.</li>

<li>SENTON &#60;date&#62; - Messages whose [RFC-2822] Date: header (disregarding time and timezone) is within the specified date.</li>

<li>SENTSINCE &#60;date&#62; - Messages whose [RFC-2822] Date: header (disregarding time and timezone) is within or later than the specified date.</li>

<li>SINCE &#60;date&#62; - Messages whose internal date (disregarding time and timezone) is within or later than the specified date.</li>

<li>SMALLER &#60;n&#62; - Messages with an [RFC-2822] size smaller than the specified number of octets.</li>

<li>SUBJECT &#60;string&#62; - Messages that contain the specified string in the envelope structure&#39;s SUBJECT field.</li>

<li>TEXT &#60;string&#62; - Messages that contain the specified string in the header or body of the message.</li>

<li>TO &#60;string&#62; - Messages that contain the specified string in the envelope structure&#39;s TO field.</li>

<li>UID &#60;sequence set&#62; - Messages with unique identifiers corresponding to the specified unique identifier set. Sequence set ranges are permitted.</li>

<li>UNANSWERED - Messages that do not have the \Answered flag set.</li>

<li>UNDELETED - Messages that do not have the \Deleted flag set.</li>

<li>UNDRAFT - Messages that do not have the \Draft flag set.</li>

<li>UNFLAGGED - Messages that do not have the \Flagged flag set.</li>

<li>UNKEYWORD &#60;flag&#62; - Messages that do not have the specified keyword flag set.</li>

<li>UNSEEN - Messages that do not have the \Seen flag set.</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FETCH_RESPONSE_TUTORIAL"
>FETCH RESPONSE TUTORIAL <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>The response to the fetch command is a tree of hash references pointing to other hash references in a tree-like structure. Going into this module and using fetch without an understanding about how the results come back is at least frustrationg and at worst futile. This section is meant to clear some of the potential confusion up, and for you to understand exactly where the data you want is stored.</p>

<p>The fetch response is stored in a tree structure of hash references. This means that it will not be uncommon for you to have ugly-looking statements like such strewn throughout your code:</p>

<blockquote>
<p>$fetch{$msgid}-&#62;{BODY}-&#62;{2}-&#62;{HEADER}-&#62;{BODY}</p>
</blockquote>

<p>By the end of this tutorial, you will hopefully understand exactly what that top statement means.</p>

<p>To understand where this structure comes from, you need to understand the structure that RFC3506 defines parts of a message. An example from the RFC looks like this:</p>

<blockquote>
<pre class="sh_perl">       HEADER     ([RFC-2822] header of the message)
       TEXT       ([RFC-2822] text body of the message) MULTIPART/MIXED
       1          TEXT/PLAIN
       2          APPLICATION/OCTET-STREAM
       3          MESSAGE/RFC822
       3.HEADER   ([RFC-2822] header of the message)
       3.TEXT     ([RFC-2822] text body of the message) MULTIPART/MIXED
       3.1        TEXT/PLAIN
       3.2        APPLICATION/OCTET-STREAM
       4          MULTIPART/MIXED
       4.1        IMAGE/GIF
       4.1.MIME   ([MIME-IMB] header for the IMAGE/GIF)
       4.2        MESSAGE/RFC822
       4.2.HEADER ([RFC-2822] header of the message)
       4.2.TEXT   ([RFC-2822] text body of the message) MULTIPART/MIXED
       4.2.1      TEXT/PLAIN
       4.2.2      MULTIPART/ALTERNATIVE
       4.2.2.1    TEXT/PLAIN
       4.2.2.2    TEXT/RICHTEXT</pre>
</blockquote>

<p>This example is rather complicated, but it gets the point across that this is no small feat. From the top, you can see that the HEADER and the TEXT are seperate pieces for the main message that was delivered, and thus can be retrieved as such. 1, 2, and 3 specify different sections of the email message - part 1 is a plain text email (the acutal text that was written to you), while part 2 is an OCTET-STREAM, perhaps a binary attachment to the email. The 3rd message is defined as an RFC822 - a bounce message. The bounce message (3), naturally has its own HEADER, and TEXT parts, along with an email with an attachment (the RFC822 bounce message included the original email, and all its attachments!). This goes on, and as you can see with part 4, the nesting can be quite deep, depending on if the email is multi-part (i.e. both plain-text and HTML), and/or if attachments have attachments, etc.</p>

<p>Now, lets look at a concrete example. Lets say that we received a plain-text email with a forwarded email as an attachment. This would mean that the message contains 2 parts, and, for the sake of argument, we know this ahead of time. The command to retrieve the header of the forwarded message would be</p>

<blockquote>
<p>my %fetch = $imap-&#62;fetch($sequence, {&#39;body&#39; =&#62; &#39;2.header&#39;});</p>
</blockquote>

<p>For this example, however, we&#39;re going to retrieve the entire message, but still seek out the forwarded message&#39;s header</p>

<blockquote>
<p>my %fetch = $imap-&#62;fetch($sequence, {});</p>
</blockquote>

<p>where $imap is a connected IMAP::Client instance, and $sequence has the message ID we are looking for.</p>

<p>Now, we need to retrieve the data that the IMAP server do dutifully sent to us, and this is where we get grease on our hands and learn exactly how to traverse a fetch response.</p>

<p>The first level of a fetch response is always the message ID of the message, and is the only level that is *not* a reference. This allows the fetch command to retrieve multiple message within a single command (i.e. using the sequence of &#39;1:*&#39; will retrieve all messages in the mailbox), and still present the data in a managable fasion.</p>

<p>Lets say that $sequence was the message &#39;1234&#39;. In order to reach the base of the message we are looking to retrieve the data from, we now need to access $fetch{1234}. Everything below here is information about our message.</p>

<p>Next, we will need to navigate to the area of the tree that will contain the data. The data we are looking for will *always* be in the same place, no matter if we retrieved the entire message, half the message, or just that one single peice of data, like the first example - if it was retreived, it will be in its specified place. This the key design feature of the fetch return structure.</p>

<p>At this level ($fetch{1234}), we can access anything about the main message. We are looking at the message from the outside, what you would normally see in your email client when you first opened a message. We can look at things like the date of the message, the flags set on this message by the imap server, the UID of the message, the envelope of the message, etc.</p>

<p>In this case, we&#39;re not interested in the main message, however. We want to retrieve the header of the forwarded message, so we need to go into the BODY of the message. To get there, we&#39;re now at $fetch{1234}-&#62;{BODY}. IMAP::Client uses the {BODY} reference to seperate it from the other aspects of the main message, incidcating its a result from a BODY fetch query. The BODY section also contains various peices of information, depending on what the CONTENTTYPE of the message is - for things like MULTIPART/ALTERNATIVE (which means the message comes in multiple forms, like plain text and HTML), there simply isn&#39;t much information to relay, since that content type is basically just a container for the two message formats. If the section is part of the actual message (rather than just a container) - for example a PLAIN/TEXT part, things like SIZE for the size of the message, LINES for number of lines in the message, and even the ENCODING and extra PARAMETERS are available.</p>

<p>Now that we&#39;re in the body, we can look at things like the content type of this particular piece of the email. Again, we&#39;re not interested in whats here. What we want is the second part of this body, the attachment part. The main body of the email that was sent is located in $fetch{1234}-&#62;{BODY}-&#62;{1}, and the attachment is located at $fetch{1234}-&#62;{BODY}-&#62;{2}. (See how the fetch structure reflects the IMAP structure of the message). Had there been more attachments or parts, there would have been more parts we could traverse, like $fetch{1234}-&#62;{BODY}-&#62;{3}.</p>

<p>Now at $fetch{1234}-&#62;{BODY}-&#62;{2}, we&#39;re in the section of the message we are interested in. Here we can find out information about the part we&#39;re in. This part is essentially identical to the first {BODY} part, only representing a subset of the mesage that {BODY} represented.</p>

<p>Now that we&#39;re here, we want the header for this part, which gives us $fetch{1234}-&#62;{BODY}-&#62;{2}-&#62;{HEADER}. We&#39;re not done yet, however, as there is still information about the HEADER available, like the SIZE. If we want the acutal HEADER body of the header, rather than a piece of information about it, we need to go one level deeper, to $fetch{1234}-&#62;{BODY}-&#62;{2}-&#62;{HEADER}-&#62;{BODY}. This is the value that will allow you to retreive the header of the forward that was sent in an attachment.</p>

<p>In the last example, we assumed that we already knew the struture of the email. In real life, this is almost never the case. If you need to know what the structure of a message looks like so you can extract a small piece of it, you can use the BODYSTRCUTRE command, which is structured simiilarly to the BODY command. If we use the example above, then we can traverse the BODYSTRUCTURE information by going to $fetch{1234}-&#62;{BODYSTRUCTURE}. From here, you can explore and poke around to see exactly what the structure is that the message has. The acutal data within a BODYSTRUCTURE is basically all the flags you would see when youre in a part - like the content type, size, lines, etc - but without any of the acutal message. As its name implies, its mainly for determining the structure and *type* of the message and its subparts. Part numbers are always sequential.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR/COPYRIGHT"
>AUTHOR/COPYRIGHT <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<pre class="sh_perl">    Copyright 2005-2006, Brenden Conte &#60;conteb at cpan dot org&#62;  All rights reserved.

    This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO <img alt='^' src='http://st.pimg.net/tucs/img/up.gif'></a></h1>

<p>perl, <a href="/perldoc?IO%3A%3ASocket" class="podlinkpod"
>IO::Socket</a>, <a href="/perldoc?IO%3A%3ASocket%3A%3ASSL" class="podlinkpod"
>IO::Socket::SSL</a>, <a href="/perldoc?MIME%3A%3ABase64" class="podlinkpod"
>MIME::Base64</a>, URI, <a href="/perldoc?URI%3A%3Aimap" class="podlinkpod"
>URI::imap</a>, <a href="/perldoc?URI%3A%3AEscape" class="podlinkpod"
>URI::Escape</a></p>

</div>
<!-- This should probably be put in the <div class="footer"></div> -->
<script type="text/javascript">
    $(document).ready(function(){
        var startingStyle = $.cookie('css') ? $.cookie('css') : 'http://st.pimg.net/tucs/css/sh_none.min.css';
        $.fn.styleSwitch(startingStyle);
        $("#styleswitch").val(startingStyle);
        sh_highlightDocument();
        $("#styleswitch").bind(($.browser.msie ? "click" : "change"), function() {
            $.fn.styleSwitch($(this).val());
        });
    });
</script>
<div class="styleswitch">
    syntax highlighting:
    <select id="styleswitch">
        <option value="http://st.pimg.net/tucs/css/sh_none.min.css">no syntax highlighting</option>
        <option value="http://st.pimg.net/tucs/css/sh_acid.min.css">acid</option>
        <option value="http://st.pimg.net/tucs/css/sh_berries-dark.min.css">berries-dark</option>
        <option value="http://st.pimg.net/tucs/css/sh_berries-light.min.css">berries-light</option>
        <option value="http://st.pimg.net/tucs/css/sh_bipolar.min.css">bipolar</option>
        <option value="http://st.pimg.net/tucs/css/sh_blacknblue.min.css">blacknblue</option>
        <option value="http://st.pimg.net/tucs/css/sh_bright.min.css">bright</option>
        <option value="http://st.pimg.net/tucs/css/sh_contrast.min.css">contrast</option>
        <option value="http://st.pimg.net/tucs/css/sh_cpan.min.css">cpan</option>
        <option value="http://st.pimg.net/tucs/css/sh_darkblue.min.css">darkblue</option>
        <option value="http://st.pimg.net/tucs/css/sh_darkness.min.css">darkness</option>
        <option value="http://st.pimg.net/tucs/css/sh_desert.min.css">desert</option>
        <option value="http://st.pimg.net/tucs/css/sh_dull.min.css">dull</option>
        <option value="http://st.pimg.net/tucs/css/sh_easter.min.css">easter</option>
        <option value="http://st.pimg.net/tucs/css/sh_emacs.min.css">emacs</option>
        <option value="http://st.pimg.net/tucs/css/sh_golden.min.css">golden</option>
        <option value="http://st.pimg.net/tucs/css/sh_greenlcd.min.css">greenlcd</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-anjuta.min.css">ide-anjuta</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-codewarrior.min.css">ide-codewarrior</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-devcpp.min.css">ide-devcpp</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-eclipse.min.css">ide-eclipse</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-kdev.min.css">ide-kdev</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-msvcpp.min.css">ide-msvcpp</option>
        <option value="http://st.pimg.net/tucs/css/sh_kwrite.min.css">kwrite</option>
        <option value="http://st.pimg.net/tucs/css/sh_matlab.min.css">matlab</option>
        <option value="http://st.pimg.net/tucs/css/sh_navy.min.css">navy</option>
        <option value="http://st.pimg.net/tucs/css/sh_nedit.min.css">nedit</option>
        <option value="http://st.pimg.net/tucs/css/sh_neon.min.css">neon</option>
        <option value="http://st.pimg.net/tucs/css/sh_night.min.css">night</option>
        <option value="http://st.pimg.net/tucs/css/sh_pablo.min.css">pablo</option>
        <option value="http://st.pimg.net/tucs/css/sh_peachpuff.min.css">peachpuff</option>
        <option value="http://st.pimg.net/tucs/css/sh_print.min.css">print</option>
        <option value="http://st.pimg.net/tucs/css/sh_rand01.min.css">rand01</option>
	<option value="http://st.pimg.net/tucs/css/sh_solarized-dark.min.css">solarized-dark</option>
	<option value="http://st.pimg.net/tucs/css/sh_solarized-light.min.css">solarized-light</option>
        <option value="http://st.pimg.net/tucs/css/sh_style.min.css">style</option>
        <option value="http://st.pimg.net/tucs/css/sh_the.min.css">the</option>
        <option value="http://st.pimg.net/tucs/css/sh_typical.min.css">typical</option>
        <option value="http://st.pimg.net/tucs/css/sh_vampire.min.css">vampire</option>
        <option value="http://st.pimg.net/tucs/css/sh_vim-dark.min.css">vim-dark</option>
        <option value="http://st.pimg.net/tucs/css/sh_vim.min.css">vim</option>
        <option value="http://st.pimg.net/tucs/css/sh_whatis.min.css">whatis</option>
        <option value="http://st.pimg.net/tucs/css/sh_whitengrey.min.css">whitengrey</option>
        <option value="http://st.pimg.net/tucs/css/sh_zellner.min.css">zellner</option>
    </select>
</div>



<div class="footer"><div class="cpanstats">78269 Uploads, 24724 Distributions
106002 Modules, 9649 Uploaders
</div>
hosted by <a href="http://www.yellowbot.com">YellowBot</a><br/>
<a href="http://www.yellowbot.com"><img alt="do. tag. write. share." src="http://st.pimg.net/tucs/img/yellowbot_logo.gif"></a>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript" src="http://ipv4.v6test.develooper.com/js/v1/v6test.js"></script>

<script type="text/javascript">
   // v6.target = '';
   if (!v6.target) { v6.only_once = true }
   v6.site = '7A0D89A6-2B82-11DF-B9DA-F61CBD13F020';
   v6.api_server = 'http://ipv4.v6test.develooper.com';
   try {
     v6.test();
   } catch(err) {}
</script>
<script type="text/javascript">
  $(document).ready(function(){
    $("a[href^=http:]").click(function(){
      var href = $(this).attr('href');
      var m = href.match('\/\/([^\/:]+)');
      _gaq.push(['_trackEvent','External',m[1],'Module']);
    });
    $("a[href^=/CPAN/]").click(function(){
      var href = $(this).attr('href');
      _gaq.push(['_trackEvent','Download',href,'Module']);
    });
  });
</script>
<!-- Fri Apr 27 22:27:19 2012 GMT (0.218930959701538) @cpansearch1 -->
 </body>
</html>
